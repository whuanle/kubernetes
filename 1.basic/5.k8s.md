# 1.1 Kubernetes 入门基础

## 导读

我们要学习 Kubernetes，就有首先了解 Kubernetes 的技术范围、基础理论知识库等，要学习 Kubernetes，肯定要有入门过程，在这个过程中，学习要从易到难，先从基础学习。

接下来笔者将为大家讲解 Kubernetes 各方面的知识，让读者了解 Kubernetes 是什么，了解其与 Docker 的关系，学习 Kubernetes 的结构。



## Kubernetes 是什么

在 2008 年，**LXC（Linux containers）** 发布第一个版本，这是最初的容器版本；2013 年，Docker 推出了第一个版本；而 Google 则在 2014 年推出了 **LMCTFY**。

为了解决大集群(Cluster)中容器部署、伸缩和管理的各种问题，出现了 Kubernetes、Docker Swarm 等软件，称为 **容器编排引擎**。

容器的产生解决了很多开发、部署痛点，但随着云原生、微服务的兴起，纯 Docker 出现了一些管理难题。我们先思考一下，运行一个 Docker 容器，只需要使用 `docker run ...` 命令即可，这是相当简单(relatibely simple)的方法。

但是，要实现以下场景，则是困难的：

* 跨多台主机的容器相互连接(connecting containers across multiple hosts)
* 拓展容器(scaling containers)
* 在不停机的情况下配置应用(deploying applications without downtime)
* 在多个方面进行服务发现(service discovery among several aspects)



### Kubernetes 是什么？

Kubernetes 是 Google 基于十多年的生产环境运维经验，开发出的一个生产级别的容器编排系统。在 Kunernetes 文档中，这样描述 Kubernetes：

_"an open-source system for automating deployment, scaling, and management of containerized applications"._

_“一个自动化部署、可拓展和管理容器应用的开源系统”_



Google 的基础设施在虚拟机(Virtual machines)技术普及之前就已经达到了很大的规模，高效地使用集群和管理分布式应用成为 Google 挑战的核心，而容器技术提供了一种高效打包集群的解决方案。

多年来，Google 一直使用 Borg 来管理集群中的容器，积累了大量的集群管理经验和运维软件开发能力，Google 参考 Borg ，开发出了 Kubernetes，即 Borg 是 Kubernetes 的前身。（但是 Google 目前还是主要使用 Borg）。

Kubernetes 从一开始就通过一组基元(primitives)、强大的和可拓展的 API 应对这些挑战，添加新对象和控制器地能力可以很容易地地址各种各样的产品需求(production needs)。

编排管理是通过一系列的监控循环控制或操作的；每个控制器都向询问对象状态，然后修改它，直至达到条件为止。容器编排是管理容器的最主要的技术。Dockers 也有其官方开发的 swarm 这个编排工具，但是在 2017 年的容器编排大战中，swarm 败于 Kubernetes。



### Kubernetes 集群的组成

在 Kubernets 中，运行应用程序的环境处于虚拟化当中，因此我们一般不谈论硬件。在 Kubernetes 中，不同的对象其管理的范围、作用范围不同，它们的边界大小也不同。

我们谈起 Kubernetes 和应用部署时，往往会涉及到容器、节点、Pods 等概念，它们共同工作来管理容器化(containerized)应用的部署和执行，但是各种各样的术语，令人眼花缭乱。为了更好地摸清 Kubernetes，下面我们将列举这些有边界的对象。

| 成分                     | 名称         |
| :----------------------- | :----------- |
| Cluster                  | 集群         |
| Node                     | 节点         |
| Pod                      | 不翻译       |
| Container                | 容器         |
| Containerzed Application | 容器化的应用 |

接下来的内容，按将从小到大的粒度介绍这些组成成分。



在 Kubernetes 中，Pod 是管理和调度的最小工作单位，Pod 中可以包含多个容器。这些容器会共享 Pod 中的网络等资源。当部署 Pod 时，会把一组关联性较强的容器部署到同一个节点上。

![pod1](./.images/pod1.png)

而节点则是指一台服务器、虚拟机等，运行着一个完整的操作系统，提供了 CPU、内存等计算资源，一个节点可以部署多个 Pod。

<img src="./.images/node1.png" alt="node1" style="zoom:50%;" />

而一个集群(Cluster)之中，运行着 N 台服务器，即 N 个节点。这些节点有两种，一种是 master 节点，一种是 worker 节点。master 节点运行着 Kubernetes 系统组件，而 worker 节点负责运行用户的程序。所有节点都归 master 管，我们通过命令、API 的方式管理 Kubernetes 集群时，是通过发送命令或请求到 master 节点上的系统组件，然后控制整个集群。

<img src="./.images/cluster1.png" alt="cluster1" style="zoom:50%;" />



### Kubernetes 结构

用图来表示体系结构，是阐述s Kubernetes 最快的方式，下面是一张称为 _Kubernetes Architecture_ graphic 的图。

![Kubernetes_Architecture_graphic](./.images/Kubernetes_Architecture_graphic.png)

上图是简单的 kubernetes 结构，左侧虚线方框中，是 master 节点，运行着各种各样的组件，master 节点负责控制整个集群，当然在很大的集群中也可以有多个 master 节点；而右侧是三个工作节点，负责运行我们的容器应用。这种结构一般称为 master-slave 结构，在 Kubernetes 中后来改称为 master-minions。

在 上图中， master 节点由多个组件构成：

* 一个 API 服务(kube-apiserver)
* 一个调度器(kube-scheduler)
* 各种各样的控制器(上图有两个控制器)
* 一个存储系统(这个组件称为etcd)，存储集群的状态、容器的设置、网络配置等数据。

这张图片中还有很多东西，这里暂时不作讲解，我们在后面的章节再去学习那些 Kubernetes 中的术语和关键字。





